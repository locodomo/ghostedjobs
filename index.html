<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ghosted ‚Äî Job Ghosting Tracker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* ‚îÄ‚îÄ LIGHT THEME ‚îÄ‚îÄ */
    :root {
      --bg:           #f8f8f8;
      --surface:      #ffffff;
      --border:       #e8e8e8;
      --border-hover: #cccccc;
      --text:         #111111;
      --text-2:       #555555;
      --text-3:       #999999;
      --accent:       #f04438;
      --accent-light: #fff1f0;
      --accent-dark:  #c0392b;
      --green-light:  #ecfdf3;
      --nav-bg:       rgba(248,248,248,0.88);
      --shadow-sm:    0 1px 3px rgba(0,0,0,0.06);
      --shadow-md:    0 4px 16px rgba(0,0,0,0.08);
      --shadow-lg:    0 8px 32px rgba(0,0,0,0.12);
      --skeleton-a:   #f0f0f0;
      --skeleton-b:   #e4e4e4;
      --sql-bg:       #f5f5f5;
      --radius:       10px;
      --radius-sm:    6px;
      --font:         'Raleway', system-ui, sans-serif;
      --transition:   background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    /* ‚îÄ‚îÄ DARK THEME ‚îÄ‚îÄ */
    [data-theme="dark"] {
      --bg:           #0f0f0f;
      --surface:      #1a1a1a;
      --border:       #2a2a2a;
      --border-hover: #3a3a3a;
      --text:         #f0f0f0;
      --text-2:       #aaaaaa;
      --text-3:       #666666;
      --accent:       #ff5a4e;
      --accent-light: #2a1210;
      --accent-dark:  #ff8a80;
      --green-light:  #0d2b1e;
      --nav-bg:       rgba(15,15,15,0.88);
      --shadow-sm:    0 1px 3px rgba(0,0,0,0.3);
      --shadow-md:    0 4px 16px rgba(0,0,0,0.4);
      --shadow-lg:    0 8px 32px rgba(0,0,0,0.5);
      --skeleton-a:   #222222;
      --skeleton-b:   #2a2a2a;
      --sql-bg:       #141414;
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      font-size: 15px;
      line-height: 1.6;
      min-height: 100vh;
      transition: var(--transition);
    }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav {
      position: sticky; top: 0; z-index: 100;
      background: var(--nav-bg);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-bottom: 1px solid var(--border);
      padding: 0 40px; height: 60px;
      display: flex; align-items: center; justify-content: space-between;
      transition: var(--transition);
    }
    .nav-logo {
      font-family: var(--font); font-size: 20px; font-weight: 800;
      color: var(--text); display: flex; align-items: center; gap: 8px;
      text-decoration: none; letter-spacing: -0.5px;
    }
    .nav-right { display: flex; align-items: center; gap: 12px; }
    .nav-pill {
      background: var(--accent-light); color: var(--accent);
      font-size: 12px; font-weight: 700;
      padding: 4px 10px; border-radius: 100px; letter-spacing: 0.3px;
    }
    .nav-reset {
      font-size: 12px; color: var(--text-3); cursor: pointer;
      background: none; border: none; font-family: var(--font);
      text-decoration: underline; padding: 0;
    }
    .nav-reset:hover { color: var(--text-2); }

    /* ‚îÄ‚îÄ DARK MODE TOGGLE ‚îÄ‚îÄ */
    .theme-toggle {
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--surface); border: 1px solid var(--border);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 16px; transition: background 0.2s, border-color 0.2s, transform 0.15s;
      box-shadow: var(--shadow-sm);
    }
    .theme-toggle:hover { background: var(--border); transform: scale(1.08); }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      max-width: 780px; margin: 0 auto;
      padding: 80px 24px 56px; text-align: center;
    }

    /* Scroll-driven animations */
    .hero-badge {
      display: inline-flex; align-items: center; gap: 6px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 100px; padding: 5px 14px 5px 8px;
      font-size: 13px; font-weight: 500; color: var(--text-2);
      margin-bottom: 28px; box-shadow: var(--shadow-sm);
      opacity: 0; transform: translateY(20px);
      animation: slideUp 0.6s ease 0.1s forwards;
    }
    .hero-badge .dot {
      width: 7px; height: 7px; background: var(--accent);
      border-radius: 50%; animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%,100% { opacity:1; transform:scale(1); }
      50%      { opacity:0.4; transform:scale(0.75); }
    }

    .hero h1 {
      font-size: clamp(36px, 6vw, 62px); font-weight: 800;
      line-height: 1.1; letter-spacing: -1.5px; margin-bottom: 20px;
      opacity: 0; transform: translateY(24px);
      animation: slideUp 0.65s ease 0.2s forwards;
    }
    .hero h1 em { font-style: italic; color: var(--accent); font-weight: 800; }

    .hero p {
      font-size: 17px; color: var(--text-2); font-weight: 400;
      max-width: 460px; margin: 0 auto 44px; line-height: 1.75;
      opacity: 0; transform: translateY(24px);
      animation: slideUp 0.65s ease 0.32s forwards;
    }

    .stats-row {
      display: flex; justify-content: center; gap: 14px; flex-wrap: wrap;
      opacity: 0; transform: translateY(24px);
      animation: slideUp 0.65s ease 0.44s forwards;
    }

    @keyframes slideUp {
      to { opacity: 1; transform: translateY(0); }
    }

    /* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
    .stat-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 18px 28px; text-align: center;
      box-shadow: var(--shadow-sm); min-width: 130px;
      transition: box-shadow 0.2s, transform 0.2s, var(--transition);
    }
    .stat-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
    .stat-num {
      font-size: 34px; font-weight: 800; color: var(--text);
      line-height: 1; margin-bottom: 4px; letter-spacing: -1px;
    }
    .stat-num.red { color: var(--accent); }
    .stat-label { font-size: 12px; color: var(--text-3); font-weight: 600; letter-spacing: 0.4px; text-transform: uppercase; }

    /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
    .container {
      max-width: 1080px; margin: 0 auto; padding: 0 24px 80px;
      display: grid; grid-template-columns: 340px 1fr;
      gap: 28px; align-items: start;
    }

    /* ‚îÄ‚îÄ FORM CARD ‚îÄ‚îÄ */
    .form-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 28px;
      box-shadow: var(--shadow-sm); position: sticky; top: 80px;
      transition: var(--transition);
    }
    .form-card h2 { font-size: 18px; font-weight: 800; margin-bottom: 4px; letter-spacing: -0.3px; }
    .form-card .subtitle { font-size: 13px; color: var(--text-3); margin-bottom: 22px; font-weight: 500; }

    .field { margin-bottom: 14px; }
    .field label {
      display: block; font-size: 12px; font-weight: 700;
      color: var(--text-2); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px;
    }
    .field input, .field select, .field textarea {
      width: 100%; background: var(--bg);
      border: 1px solid var(--border); border-radius: var(--radius-sm);
      color: var(--text); padding: 10px 12px;
      font-family: var(--font); font-size: 14px; font-weight: 500; outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, var(--transition);
      -webkit-appearance: none;
    }
    .field input:focus, .field select:focus, .field textarea:focus {
      border-color: var(--text); box-shadow: 0 0 0 3px rgba(17,17,17,0.07);
    }
    [data-theme="dark"] .field input:focus,
    [data-theme="dark"] .field select:focus,
    [data-theme="dark"] .field textarea:focus {
      box-shadow: 0 0 0 3px rgba(240,240,240,0.08);
    }
    .field input.error { border-color: var(--accent) !important; }
    .field input::placeholder, .field textarea::placeholder { color: var(--text-3); }
    .field select {
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px;
    }
    .field select option { background: var(--surface); color: var(--text); }
    .field textarea { resize: vertical; min-height: 78px; line-height: 1.5; }

    .submit-btn {
      width: 100%; background: var(--text); color: var(--bg); border: none;
      border-radius: var(--radius-sm); padding: 12px 20px;
      font-family: var(--font); font-size: 14px; font-weight: 700; cursor: pointer;
      transition: opacity 0.15s, transform 0.1s, box-shadow 0.15s;
      display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 6px;
      letter-spacing: 0.2px;
    }
    .submit-btn:hover { opacity: 0.85; box-shadow: var(--shadow-md); }
    .submit-btn:active { transform: scale(0.98); }
    .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; box-shadow: none; transform: none; }

    .toast {
      margin-top: 12px; padding: 10px 13px; border-radius: var(--radius-sm);
      font-size: 13px; font-weight: 600; display: none;
      align-items: center; gap: 8px; animation: slideUp 0.25s ease;
    }
    .toast.success { background: var(--green-light); color: #0a7a48; display: flex; }
    .toast.error   { background: var(--accent-light); color: var(--accent-dark); display: flex; }
    [data-theme="dark"] .toast.success { color: #4ade80; }
    [data-theme="dark"] .toast.error   { color: var(--accent); }

    .privacy-note {
      margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);
      font-size: 12px; color: var(--text-3); line-height: 1.6; font-weight: 500;
    }

    /* ‚îÄ‚îÄ REPORTS PANEL ‚îÄ‚îÄ */
    .reports-toolbar {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 14px; flex-wrap: wrap; gap: 10px;
    }
    .reports-toolbar h2 { font-size: 18px; font-weight: 800; letter-spacing: -0.3px; }
    .count-badge {
      font-size: 12px; font-weight: 700; color: var(--text-3);
      background: var(--surface); border: 1px solid var(--border);
      padding: 3px 10px; border-radius: 100px;
    }

    .filter-tabs {
      display: flex; gap: 3px; background: var(--surface);
      border: 1px solid var(--border); border-radius: var(--radius-sm);
      padding: 3px; flex-wrap: wrap; margin-bottom: 18px;
      transition: var(--transition);
    }
    .tab {
      background: transparent; border: none; border-radius: 5px;
      padding: 6px 12px; font-family: var(--font); font-size: 12px;
      font-weight: 700; color: var(--text-3); cursor: pointer;
      transition: all 0.12s; white-space: nowrap; letter-spacing: 0.3px;
      text-transform: uppercase;
    }
    .tab:hover { color: var(--text); background: var(--bg); }
    .tab.active { background: var(--text); color: var(--bg); }

    /* ‚îÄ‚îÄ REPORT CARD ‚îÄ‚îÄ */
    .report-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 18px 20px; margin-bottom: 8px;
      display: flex; justify-content: space-between; align-items: flex-start;
      gap: 16px; box-shadow: var(--shadow-sm);
      transition: box-shadow 0.18s, border-color 0.18s, transform 0.18s, var(--transition);
      animation: slideUp 0.35s ease both;
    }
    .report-card:hover {
      box-shadow: var(--shadow-md); border-color: var(--border-hover);
      transform: translateY(-1px);
    }
    .card-left { flex: 1; min-width: 0; }
    .card-top { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; flex-wrap: wrap; }
    .company-name { font-size: 15px; font-weight: 700; color: var(--text); }

    .stage-pill {
      font-size: 10px; font-weight: 700; padding: 2px 9px;
      border-radius: 100px; letter-spacing: 0.5px; white-space: nowrap;
      flex-shrink: 0; text-transform: uppercase;
    }
    .stage-pill.applied      { background:#eef2ff; color:#4361ee; }
    .stage-pill.phone-screen { background:#fff8ec; color:#c27e00; }
    .stage-pill.interview    { background:#f3f0ff; color:#6941c6; }
    .stage-pill.final-round  { background:#fff1f0; color:var(--accent); }
    .stage-pill.offer-stage  { background:#ecfdf3; color:#027a48; }
    [data-theme="dark"] .stage-pill.applied      { background:#1a2060; color:#a5b4fc; }
    [data-theme="dark"] .stage-pill.phone-screen { background:#2a1f00; color:#fbbf24; }
    [data-theme="dark"] .stage-pill.interview    { background:#200d5e; color:#c4b5fd; }
    [data-theme="dark"] .stage-pill.final-round  { background:#2a1010; color:#ff8a80; }
    [data-theme="dark"] .stage-pill.offer-stage  { background:#0d2b1e; color:#4ade80; }

    .card-meta { display: flex; gap: 14px; flex-wrap: wrap; font-size: 13px; color: var(--text-3); font-weight: 500; }
    .card-meta span { display: flex; align-items: center; gap: 4px; }

    .card-note {
      margin-top: 10px; font-size: 13px; color: var(--text-2);
      line-height: 1.6; padding: 9px 12px;
      background: var(--bg); border-radius: var(--radius-sm);
      border-left: 3px solid var(--border); font-weight: 400;
    }
    .card-right { text-align: right; flex-shrink: 0; }
    .time-ago { font-size: 12px; color: var(--text-3); white-space: nowrap; font-weight: 500; }

    /* ‚îÄ‚îÄ SKELETONS ‚îÄ‚îÄ */
    .skeleton {
      background: linear-gradient(90deg, var(--skeleton-a) 25%, var(--skeleton-b) 50%, var(--skeleton-a) 75%);
      background-size: 200% 100%; animation: shimmer 1.4s infinite; border-radius: 4px;
    }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .skeleton-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 18px 20px; margin-bottom: 8px;
    }

    /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
    .empty-state { text-align: center; padding: 64px 24px; color: var(--text-3); }
    .empty-icon  { font-size: 52px; display: block; margin-bottom: 14px; }
    .empty-state h3 { font-size: 20px; font-weight: 800; color: var(--text-2); margin-bottom: 6px; }
    .empty-state p  { font-size: 14px; font-weight: 500; }

    /* ‚îÄ‚îÄ SETUP OVERLAY ‚îÄ‚îÄ */
    #setup-overlay {
      position: fixed; inset: 0; background: var(--bg);
      opacity: 0.97;
      backdrop-filter: blur(8px); z-index: 1000;
      display: flex; align-items: center; justify-content: center; padding: 24px;
      transition: var(--transition);
    }
    .setup-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 16px; padding: 40px 44px;
      max-width: 520px; width: 100%; box-shadow: var(--shadow-lg);
      transition: var(--transition);
    }
    .setup-card h2 { font-size: 24px; font-weight: 800; margin-bottom: 6px; letter-spacing: -0.5px; }
    .setup-card > p { font-size: 14px; color: var(--text-2); margin-bottom: 26px; line-height: 1.6; font-weight: 400; }
    .setup-btn {
      width: 100%; background: var(--text); color: var(--bg); border: none;
      border-radius: var(--radius-sm); padding: 13px;
      font-family: var(--font); font-size: 14px; font-weight: 700;
      cursor: pointer; margin-top: 8px; transition: opacity 0.15s; letter-spacing: 0.2px;
    }
    .setup-btn:hover { opacity: 0.82; }
    .setup-steps {
      margin-top: 22px; padding-top: 20px; border-top: 1px solid var(--border);
      font-size: 13px; color: var(--text-3); line-height: 1.9; font-weight: 500;
    }
    .setup-steps a { color: var(--text); }
    .setup-steps strong { color: var(--text-2); }
    .sql-block {
      display: block; background: var(--sql-bg); border: 1px solid var(--border);
      border-radius: var(--radius-sm); padding: 12px 14px; margin: 8px 0;
      font-family: 'SF Mono','Fira Code','Courier New',monospace;
      font-size: 11px; white-space: pre; overflow-x: auto; line-height: 1.7;
      color: var(--text-2);
    }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer {
      border-top: 1px solid var(--border); padding: 22px 40px;
      font-size: 13px; font-weight: 500; color: var(--text-3);
      display: flex; justify-content: space-between; align-items: center;
      flex-wrap: wrap; gap: 8px; transition: var(--transition);
    }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 820px) {
      nav { padding: 0 20px; }
      .hero { padding: 52px 20px 40px; }
      .container { grid-template-columns: 1fr; padding: 0 16px 60px; }
      .form-card { position: static; }
      footer { padding: 18px 20px; }
      .setup-card { padding: 28px 24px; }
    }
  </style>
</head>
<body>

<!-- ‚îÄ‚îÄ SETUP OVERLAY ‚îÄ‚îÄ -->
<div id="setup-overlay">
  <div class="setup-card">
    <h2>Connect Supabase üëª</h2>
    <p>Enter your Supabase project credentials below. Saved locally so you only do this once.</p>

    <div class="field">
      <label>Supabase Project URL</label>
      <input type="text" id="setup-url" placeholder="https://xxxxxxxxxxxx.supabase.co" autocomplete="off" spellcheck="false" />
    </div>
    <div class="field">
      <label>Anon / Public API Key</label>
      <input type="text" id="setup-key" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." autocomplete="off" spellcheck="false" />
    </div>
    <div id="setup-error" style="display:none;font-size:13px;color:var(--accent);margin-top:8px;padding:8px 12px;background:var(--accent-light);border-radius:var(--radius-sm);font-weight:600;"></div>

    <button class="setup-btn" onclick="saveCredentials()">Connect &amp; Launch ‚Üí</button>

    <div class="setup-steps">
      <strong>How to set up Supabase:</strong><br>
      1. Go to <a href="https://supabase.com" target="_blank">supabase.com</a> ‚Üí create a new project<br>
      2. Open <strong>SQL Editor</strong> and run this schema:
      <code class="sql-block">CREATE TABLE ghosted_reports (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  company text NOT NULL,
  role text,
  stage text NOT NULL,
  days_waited integer,
  note text,
  created_at timestamptz DEFAULT now()
);
ALTER TABLE ghosted_reports ENABLE ROW LEVEL SECURITY;
CREATE POLICY "public read"
  ON ghosted_reports FOR SELECT USING (true);
CREATE POLICY "public insert"
  ON ghosted_reports FOR INSERT WITH CHECK (true);</code>
      3. Go to <strong>Project Settings ‚Üí API</strong> and copy your URL &amp; anon key above.
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ NAV ‚îÄ‚îÄ -->
<nav>
  <a href="#" class="nav-logo">üëª Ghosted</a>
  <div class="nav-right">
    <span class="nav-pill" id="nav-count">Loading‚Ä¶</span>
    <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode">üåô</button>
    <button class="nav-reset" onclick="resetCreds()">Disconnect</button>
  </div>
</nav>

<!-- ‚îÄ‚îÄ HERO ‚îÄ‚îÄ -->
<div class="hero">
  <div class="hero-badge">
    <span class="dot"></span>
    Real reports, updated live
  </div>
  <h1>They never called back.<br><em>Now everyone knows.</em></h1>
  <p>A community-powered tracker for job seekers. Report ghosting, see who's doing it, and move on faster.</p>

  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-num red" id="stat-reports">‚Äî</div>
      <div class="stat-label">Total Reports</div>
    </div>
    <div class="stat-card">
      <div class="stat-num" id="stat-companies">‚Äî</div>
      <div class="stat-label">Companies</div>
    </div>
    <div class="stat-card">
      <div class="stat-num" id="stat-avg-days">‚Äî</div>
      <div class="stat-label">Avg. Wait</div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
<div class="container">

  <!-- FORM -->
  <aside>
    <div class="form-card">
      <h2>Report a ghost</h2>
      <p class="subtitle">Anonymous. No sign-up. 30 seconds.</p>

      <div class="field">
        <label>Company Name <span style="color:var(--accent)">*</span></label>
        <input type="text" id="inp-company" placeholder="e.g. Acme Corp" autocomplete="off" />
      </div>
      <div class="field">
        <label>Role Applied For</label>
        <input type="text" id="inp-role" placeholder="e.g. Product Designer" autocomplete="off" />
      </div>
      <div class="field">
        <label>Ghosted At Stage <span style="color:var(--accent)">*</span></label>
        <select id="inp-stage">
          <option value="Applied">Applied</option>
          <option value="Phone Screen">Phone Screen</option>
          <option value="Interview">Interview</option>
          <option value="Final Round">Final Round</option>
          <option value="Offer Stage">Offer Stage</option>
        </select>
      </div>
      <div class="field">
        <label>Days Waiting <span style="color:var(--text-3);font-weight:500;text-transform:none">(optional)</span></label>
        <input type="number" id="inp-days" placeholder="e.g. 21" min="1" max="730" />
      </div>
      <div class="field">
        <label>What happened? <span style="color:var(--text-3);font-weight:500;text-transform:none">(optional)</span></label>
        <textarea id="inp-note" placeholder="e.g. Had 4 rounds of interviews, then complete silence‚Ä¶"></textarea>
      </div>

      <button class="submit-btn" id="submit-btn" onclick="submitReport()">
        <span>Submit Report</span><span>‚Üí</span>
      </button>

      <div class="toast" id="toast"></div>

      <p class="privacy-note">üîí Reports are anonymous. No account needed. All data is shared publicly.</p>
    </div>
  </aside>

  <!-- REPORTS -->
  <section class="reports-panel">
    <div class="reports-toolbar">
      <h2>Recent Reports</h2>
      <span class="count-badge" id="count-badge">Loading‚Ä¶</span>
    </div>

    <div class="filter-tabs">
      <button class="tab active" data-stage="All"          onclick="setFilter('All', this)">All</button>
      <button class="tab"        data-stage="Applied"      onclick="setFilter('Applied', this)">Applied</button>
      <button class="tab"        data-stage="Phone Screen" onclick="setFilter('Phone Screen', this)">Phone</button>
      <button class="tab"        data-stage="Interview"    onclick="setFilter('Interview', this)">Interview</button>
      <button class="tab"        data-stage="Final Round"  onclick="setFilter('Final Round', this)">Final</button>
      <button class="tab"        data-stage="Offer Stage"  onclick="setFilter('Offer Stage', this)">Offer</button>
    </div>

    <div id="report-list"></div>
  </section>
</div>

<footer>
  <span>üëª Ghosted ‚Äî for job seekers, by job seekers</span>
  <span>All reports are anonymous &amp; community-powered</span>
</footer>

<script>
(function() {
  const CRED_KEY  = 'ghosted_supabase_v1';
  const THEME_KEY = 'ghosted_theme';
  let db           = null;
  let allReports   = [];
  let activeFilter = 'All';

  /* ‚îÄ‚îÄ THEME ‚îÄ‚îÄ */
  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    document.getElementById('theme-toggle').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    localStorage.setItem(THEME_KEY, theme);
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme');
    applyTheme(current === 'dark' ? 'light' : 'dark');
  }

  // Init theme from saved preference or system preference
  (function initTheme() {
    const saved = localStorage.getItem(THEME_KEY);
    if (saved) { applyTheme(saved); return; }
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(prefersDark ? 'dark' : 'light');
  })();

  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  window.toggleTheme = toggleTheme;

  /* ‚îÄ‚îÄ CREDENTIALS ‚îÄ‚îÄ */
  function loadCredentials() {
    try { const c = JSON.parse(localStorage.getItem(CRED_KEY)); if (c?.url && c?.key) return c; } catch(_) {}
    return null;
  }

  async function saveCredentials() {
    const url = document.getElementById('setup-url').value.trim();
    const key = document.getElementById('setup-key').value.trim();
    const err = document.getElementById('setup-error');
    err.style.display = 'none';

    if (!url || !key) { err.textContent = 'Please fill in both fields.'; err.style.display = 'block'; return; }
    if (!url.startsWith('https://')) { err.textContent = 'URL must start with https://'; err.style.display = 'block'; return; }

    localStorage.setItem(CRED_KEY, JSON.stringify({ url, key }));
    initDB(url, key);

    try {
      const { error } = await db.from('ghosted_reports').select('id').limit(1);
      if (error) throw error;
      document.getElementById('setup-overlay').style.display = 'none';
      loadReports();
    } catch(e) {
      err.textContent = 'Could not connect. Check your URL, key, and that the table exists.';
      err.style.display = 'block';
    }
  }

  function initDB(url, key) {
    db = window.supabase.createClient(url, key);
  }

  function resetCreds() {
    if (!confirm('Disconnect from Supabase? You can reconnect anytime.')) return;
    localStorage.removeItem(CRED_KEY);
    location.reload();
  }

  /* ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ */
  function esc(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function timeAgo(iso) {
    const m = Math.floor((Date.now() - new Date(iso)) / 60000);
    if (m < 1)  return 'just now';
    if (m < 60) return m + 'm ago';
    const h = Math.floor(m / 60);
    if (h < 24) return h + 'h ago';
    const d = Math.floor(h / 24);
    if (d < 30) return d + 'd ago';
    return Math.floor(d / 30) + 'mo ago';
  }

  function pillClass(stage) {
    return ({ Applied:'applied', 'Phone Screen':'phone-screen', Interview:'interview', 'Final Round':'final-round', 'Offer Stage':'offer-stage' })[stage] || 'applied';
  }

  function showToast(msg, type) {
    const t = document.getElementById('toast');
    t.className = 'toast ' + type;
    t.innerHTML = (type === 'success' ? '‚úì ' : '‚ö† ') + esc(msg);
    if (type === 'success') setTimeout(() => t.style.display = 'none', 4500);
  }

  /* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
  function updateStats(data) {
    document.getElementById('stat-reports').textContent   = data.length;
    document.getElementById('stat-companies').textContent = new Set(data.map(r => r.company.toLowerCase().trim())).size;
    const d = data.filter(r => r.days_waited);
    document.getElementById('stat-avg-days').textContent  = d.length ? Math.round(d.reduce((a,r) => a + r.days_waited, 0) / d.length) + 'd' : '‚Äî';
    document.getElementById('nav-count').textContent = data.length + ' report' + (data.length !== 1 ? 's' : '');
  }

  /* ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ */
  function renderSkeletons() {
    document.getElementById('report-list').innerHTML = [0,1,2,3].map(() => `
      <div class="skeleton-card">
        <div class="skeleton" style="height:15px;width:38%;margin-bottom:10px"></div>
        <div class="skeleton" style="height:13px;width:62%;margin-bottom:8px"></div>
        <div class="skeleton" style="height:12px;width:24%"></div>
      </div>`).join('');
  }

  function render() {
    const filtered = activeFilter === 'All' ? allReports : allReports.filter(r => r.stage === activeFilter);
    document.getElementById('count-badge').textContent = filtered.length + ' report' + (filtered.length !== 1 ? 's' : '');
    const list = document.getElementById('report-list');

    if (!filtered.length) {
      list.innerHTML = `<div class="empty-state">
        <span class="empty-icon">üëª</span>
        <h3>${activeFilter === 'All' ? 'No reports yet.' : 'No "' + activeFilter + '" reports.'}</h3>
        <p>Be the first to submit one ‚Äî it takes 30 seconds.</p>
      </div>`; return;
    }

    list.innerHTML = filtered.map((r, i) => `
      <div class="report-card" style="animation-delay:${Math.min(i * 35, 280)}ms">
        <div class="card-left">
          <div class="card-top">
            <span class="company-name">${esc(r.company)}</span>
            <span class="stage-pill ${pillClass(r.stage)}">${esc(r.stage)}</span>
          </div>
          <div class="card-meta">
            ${r.role        ? `<span>üíº ${esc(r.role)}</span>` : ''}
            ${r.days_waited ? `<span>‚è≥ ${r.days_waited} day${r.days_waited !== 1 ? 's' : ''}</span>` : ''}
          </div>
          ${r.note ? `<div class="card-note">${esc(r.note)}</div>` : ''}
        </div>
        <div class="card-right"><div class="time-ago">${timeAgo(r.created_at)}</div></div>
      </div>`).join('');
  }

  /* ‚îÄ‚îÄ LOAD ‚îÄ‚îÄ */
  async function loadReports() {
    renderSkeletons();
    try {
      const { data, error } = await db
        .from('ghosted_reports').select('*')
        .order('created_at', { ascending: false }).limit(300);
      if (error) throw error;
      allReports = data || [];
      updateStats(allReports);
      render();
    } catch(e) {
      console.error(e);
      document.getElementById('report-list').innerHTML = `
        <div class="empty-state">
          <span class="empty-icon">‚ö†Ô∏è</span>
          <h3>Could not load reports</h3>
          <p>Check your Supabase credentials. <a href="#" onclick="resetCreds()" style="color:var(--text)">Reconnect ‚Üí</a></p>
        </div>`;
    }
  }

  /* ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ */
  async function submitReport() {
    const company = document.getElementById('inp-company').value.trim();
    const stage   = document.getElementById('inp-stage').value;
    const role    = document.getElementById('inp-role').value.trim() || null;
    const days    = parseInt(document.getElementById('inp-days').value) || null;
    const note    = document.getElementById('inp-note').value.trim() || null;
    const ci      = document.getElementById('inp-company');

    if (!company) { ci.classList.add('error'); ci.focus(); return; }
    ci.classList.remove('error');

    const btn = document.getElementById('submit-btn');
    btn.disabled = true;
    btn.innerHTML = '<span>Submitting‚Ä¶</span>';

    try {
      const { data, error } = await db
        .from('ghosted_reports')
        .insert([{ company, role, stage, days_waited: days, note }])
        .select().single();
      if (error) throw error;

      allReports.unshift(data);
      updateStats(allReports);

      ['inp-company','inp-role','inp-days','inp-note'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('inp-stage').selectedIndex = 0;

      showToast('Report submitted! Thanks for helping the community.', 'success');
      setFilter('All', document.querySelector('[data-stage="All"]'));

    } catch(e) {
      console.error(e);
      showToast('Failed to submit. Check your connection and try again.', 'error');
    } finally {
      btn.disabled = false;
      btn.innerHTML = '<span>Submit Report</span><span>‚Üí</span>';
    }
  }

  /* ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ */
  function setFilter(stage, btn) {
    activeFilter = stage;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    render();
  }

  /* ‚îÄ‚îÄ KEYBOARD ‚îÄ‚îÄ */
  document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && e.target.matches('#inp-company,#inp-role,#inp-days')) submitReport();
    if (e.key === 'Enter' && e.target.id === 'setup-key') saveCredentials();
  });

  /* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
  const creds = loadCredentials();
  if (creds) {
    initDB(creds.url, creds.key);
    document.getElementById('setup-overlay').style.display = 'none';
    loadReports();
  }

  /* ‚îÄ‚îÄ EXPOSE to HTML onclick handlers ‚îÄ‚îÄ */
  window.saveCredentials = saveCredentials;
  window.resetCreds      = resetCreds;
  window.submitReport    = submitReport;
  window.setFilter       = setFilter;
})();
</script>
</body>
</html>
